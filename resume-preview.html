<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Resume Preview</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Merriweather&family=Montserrat:wght@500&family=Roboto+Mono&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    background:linear-gradient(135deg,#6a0dad,#9b59b6);
    font-family:Arial,sans-serif;
    padding:40px;
}
.container{
    max-width:1200px;
    margin:auto;
    display:flex;
    gap:25px;
}
.actions{
    width:220px;
    background:#fff;
    padding:25px;
    border-radius:14px;
}
.actions button{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    border-radius:8px;
    border:none;
    cursor:pointer;
}
.download-btn{background:#6a0dad;color:#fff}

.resume{
    flex:1;
    background:#fff;
    padding:40px;
    border-radius:18px;
    display:none;
}

/* ===== TEMPLATES ===== */
.template-clean{font-family:Merriweather;}
.template-clean h1{font-size:32px}
.template-clean h3{border-bottom:2px solid #000}

.template-sidebar{display:grid;grid-template-columns:30% 70%;font-family:Poppins}
.template-sidebar .left{background:#f2e8dc;padding:25px}
.template-sidebar .right{padding:30px}

.template-ats{font-family:Arial;font-size:14px}
.template-ats h3{text-transform:uppercase;border-bottom:1px solid #000;font-size:13px}

.template-modern{font-family:Poppins}
.template-modern h1{color:#3498db}
.template-modern h3{border-bottom:2px solid #3498db}

.template-executive{font-family:Montserrat}
.template-executive h1{text-align:center}
.template-executive section{background:#f8f8f8;padding:15px;border-radius:8px;margin-bottom:15px}

.template-creative{display:grid;grid-template-columns:28% 72%;font-family:Poppins}
.template-creative .left{background:#ffeaa7;padding:25px}
.template-creative .right{padding:30px}

.template-technical{font-family:Roboto Mono}
.template-technical h3{background:#eee;padding:6px}

.template-academic{font-family:Merriweather}
.template-academic h1{font-size:28px;letter-spacing:1px}

.template-startup{display:grid;grid-template-columns:32% 68%;font-family:Poppins}
.template-startup .left{background:#2d3436;color:#fff;padding:25px}
.template-startup .right{padding:30px}

.template-corporate{font-family:Arial}
.template-corporate section{border-left:6px solid #6a0dad;padding-left:15px;margin-bottom:18px}

@media print{
    body{background:none;padding:0}
    .actions{display:none}
}
</style>
</head>

<body>

<div class="container">

<!-- ACTIONS -->
<div class="actions">
    <button onclick="editResume()">Edit Resume</button>
    <button onclick="goToDashboard()">Go to Dashboard</button>
    <button onclick="changeTemplate()">Change Template</button>
<button onclick="printResume()" class="download-btn">
    Download / Print
</button>


</div>

<!-- ===== TEMPLATES (UNCHANGED) ===== -->
<div class="resume template-clean" id="t0">
    <h1 id="n"></h1><p id="c"></p>
    <h3>Summary</h3><p id="s"></p>
    <h3>Experience</h3><p id="e"></p>
    <h3>Education</h3><p id="ed"></p>
    <h3>Skills</h3><ul id="sk"></ul>
</div>

<div class="resume template-sidebar" id="t1">
<div class="left">
    <h2 id="n1"></h2><p id="c1"></p>
    <h3>Skills</h3><ul id="sk1"></ul>
</div>
<div class="right">
    <h3>Summary</h3><p id="s1"></p>
    <h3>Experience</h3><p id="e1"></p>
    <h3>Education</h3><p id="ed1"></p>
</div>
</div>

<div class="resume template-ats" id="t2">
<h1 id="n2"></h1><p id="c2"></p>
<h3>Summary</h3><p id="s2"></p>
<h3>Experience</h3><p id="e2"></p>
<h3>Education</h3><p id="ed2"></p>
<h3>Skills</h3><p id="sk2"></p>
</div>

<div class="resume template-modern" id="t3">
<h1 id="n3"></h1><p id="c3"></p>
<h3>Summary</h3><p id="s3"></p>
<h3>Experience</h3><p id="e3"></p>
<h3>Education</h3><p id="ed3"></p>
<h3>Skills</h3><ul id="sk3"></ul>
</div>

<div class="resume template-executive" id="t4">
<h1 id="n4"></h1><p id="c4"></p>
<section><h3>Summary</h3><p id="s4"></p></section>
<section><h3>Experience</h3><p id="e4"></p></section>
<section><h3>Education</h3><p id="ed4"></p></section>
<section><h3>Skills</h3><ul id="sk4"></ul></section>
</div>

<div class="resume template-creative" id="t5">
<div class="left">
<h2 id="n5"></h2><p id="c5"></p>
<h3>Skills</h3><ul id="sk5"></ul>
</div>
<div class="right">
<h3>Summary</h3><p id="s5"></p>
<h3>Experience</h3><p id="e5"></p>
<h3>Education</h3><p id="ed5"></p>
</div>
</div>

<div class="resume template-technical" id="t6">
<h1 id="n6"></h1><p id="c6"></p>
<h3>Summary</h3><p id="s6"></p>
<h3>Experience</h3><p id="e6"></p>
<h3>Education</h3><p id="ed6"></p>
<h3>Skills</h3><ul id="sk6"></ul>
</div>

<div class="resume template-academic" id="t7">
<h1 id="n7"></h1><p id="c7"></p>
<h3>Summary</h3><p id="s7"></p>
<h3>Experience</h3><p id="e7"></p>
<h3>Education</h3><p id="ed7"></p>
<h3>Skills</h3><ul id="sk7"></ul>
</div>

<div class="resume template-startup" id="t8">
<div class="left">
<h2 id="n8"></h2><p id="c8"></p>
<h3>Skills</h3><ul id="sk8"></ul>
</div>
<div class="right">
<h3>Summary</h3><p id="s8"></p>
<h3>Experience</h3><p id="e8"></p>
<h3>Education</h3><p id="ed8"></p>
</div>
</div>

<div class="resume template-corporate" id="t9">
<h1 id="n9"></h1><p id="c9"></p>
<section><h3>Summary</h3><p id="s9"></p></section>
<section><h3>Experience</h3><p id="e9"></p></section>
<section><h3>Education</h3><p id="ed9"></p></section>
<section><h3>Skills</h3><ul id="sk9"></ul></section>
</div>

</div>

<script>
    console.log(
  "[AUTH CHECK]",
  location.pathname,
  localStorage.getItem("loggedUser")
);

const API = "http://localhost:5000";
const user = JSON.parse(localStorage.getItem("loggedUser"));




/* ================= LOAD RESUME DATA ================= */
const historyId = localStorage.getItem("historyResumeId");
let data = null;

async function loadResume() {
    if (historyId) {
        const res = await fetch(`${API}/resume/${historyId}`);
        const r = await res.json();
        data = JSON.parse(r.resume_data);
        localStorage.removeItem("historyResumeId");
    } else {
        data = JSON.parse(localStorage.getItem("resumeData"));
    }

    if (!data) {
        alert("No resume found");
        window.location.href = "dashboard.html";
        return;
    }

    render(0);
}

/* ================= TEMPLATE RENDER ================= */
let index = 0;
const templates = document.querySelectorAll(".resume");

function render(i) {
    templates.forEach(t => t.style.display = "none");
    templates[i].style.display = "block";

    for (let k = 0; k < 10; k++) {
        const id = k === 0 ? "" : k;
        const map = {
            ["n" + id]: data.name,
            ["c" + id]: `${data.email || ""} | ${data.phone || ""}`,
            ["s" + id]: data.summary,
            ["e" + id]: data.experience,
            ["ed" + id]: data.education
        };

        Object.keys(map).forEach(key => {
            const el = document.getElementById(key);
            if (el) el.textContent = map[key] || "";
        });

        const sk = document.getElementById("sk" + id);
        if (sk) {
            sk.innerHTML = "";
            (data.skills || "").split(/,|\n/).forEach(s => {
                if (s.trim()) {
                    const li = document.createElement("li");
                    li.textContent = s.trim();
                    sk.appendChild(li);
                }
            });
        }
    }
}
async function savePrintedResume() {
    if (!user || !user.id) {
        alert("User not logged in");
        return;
    }

    try {
        const res = await fetch(`${API}/resume/save`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                userId: user.id,
                resumeName: `Resume - ${new Date().toLocaleString()}`,
                resumeData: data,
                pdfBase64: "PRINTED" // placeholder
            })
        });

        const result = await res.json();
        if (!result.success) {
            alert("Failed to save resume");
            return;
        }

        // âœ… print AFTER save completes
        setTimeout(() => window.print(), 300);

    } catch (err) {
        console.error("Save resume failed:", err);
        alert("Error saving resume");
    }
}


/* ================= ACTIONS ================= */
function changeTemplate() {
    index = (index + 1) % templates.length;
    render(index);
}

function editResume() {
    window.location.href = "form-edit.html";
}

function goToDashboard() {
    window.location.href = "dashboard.html";
}

/* ================= SAVE PRINTED RESUME ================= */
function printResume() {
    savePrintedResume();
}


/* ================= START ================= */
loadResume();
</script>



</body>
</html>
