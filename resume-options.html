<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Resume | Resume Builder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- MINIMAL THEME VARIABLES --- */
        :root {
            --primary: #2563eb;       /* Royal Blue */
            --primary-dark: #1e40af;
            --text-main: #0f172a;     /* Dark Slate */
            --text-light: #64748b;    /* Light Slate */
            --bg-body: #f8fafc;       /* Light Gray Background */
            --bg-card: #ffffff;       /* White Card Background */
            --border: #e2e8f0;
            --accent: #10b981;        /* Kept for JS success message compatibility */
            --transition: all 0.2s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden; 
            display: flex;
            flex-direction: column;
        }

        /* --- REMOVED BLOBS (Minimalist Look) --- */
        .blob { display: none; }

        /* --- Navigation Header --- */
        .nav-header {
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dashboard-btn {
            background: var(--bg-card);
            color: var(--text-main);
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dashboard-btn:hover {
            background: var(--bg-body);
            border-color: var(--text-light);
            transform: translateX(-3px);
        }

        .nav-header h1 {
            font-size: 1.25rem; 
            font-weight: 700; 
            color: var(--text-main); 
            letter-spacing: -0.5px;
            margin: 0;
        }

        /* --- Content Container --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            text-align: center;
        }

        .welcome-text { margin-bottom: 50px; animation: fadeIn 0.5s ease; }
        .welcome-text h2 { font-size: 2.2rem; font-weight: 700; margin-bottom: 10px; color: var(--text-main); }
        .welcome-text p { color: var(--text-light); font-size: 1.05rem; }

        /* --- Option Cards (Minimalist) --- */
        .options {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .option-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 40px 30px;
            border-radius: 16px;
            width: 100%;
            max-width: 380px;
            transition: var(--transition);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            opacity: 0;
            animation: slideUp 0.5s ease forwards;
        }

        .option-card:nth-child(1) { animation-delay: 0.1s; }
        .option-card:nth-child(2) { animation-delay: 0.2s; }

        .option-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
        }

        .card-icon {
            font-size: 40px; 
            color: var(--primary); 
            margin-bottom: 20px;
        }

        .option-card h3 { 
            font-size: 1.25rem; 
            margin-bottom: 10px; 
            font-weight: 700; 
            color: var(--text-main); 
        }
        
        .option-card p { 
            font-size: 0.95rem; 
            color: var(--text-light); 
            margin-bottom: 25px; 
            line-height: 1.5; 
            flex-grow: 1;
        }

        /* --- Drop Zone Upgrade --- */
        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 25px 15px;
            background: var(--bg-body);
            margin-bottom: 25px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }

        .drop-zone.dragover {
            border-color: var(--primary);
            background: #eff6ff;
            color: var(--primary);
        }

        /* Placeholder for Scratch layout */
        .scratch-placeholder {
            height: 100px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin-bottom: 25px;
            background: var(--bg-body);
            border-radius: 12px;
            border: 1px solid var(--border);
            color: var(--text-light);
            opacity: 0.6;
        }

        /* --- Buttons --- */
        button {
            background: var(--primary);
            color: white; 
            border: 1px solid var(--primary); 
            padding: 14px 25px; 
            border-radius: 8px;
            width: 100%; 
            font-weight: 600; 
            cursor: pointer; 
            transition: var(--transition);
            font-size: 0.95rem; 
            font-family: inherit;
        }

        button:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .primary-btn {
            background: white;
            color: var(--text-main);
            border: 1px solid var(--border);
        }

        .primary-btn:hover {
            background: var(--bg-body);
            border-color: var(--text-light);
            color: var(--text-main);
        }

        /* --- Keyframes --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>

<body>

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div class="nav-header">
        <a href="dashboard.html" class="dashboard-btn">
            <i class="fas fa-arrow-left"></i> Dashboard
        </a>
        <h1>Resume Builder</h1>
        <div style="width: 100px;"></div> </div>

    <div class="main-content">
        <div class="welcome-text">
            <h2>Create Your Resume</h2>
            <p>Choose your preferred method to get started</p>
        </div>

        <div class="options">
            <div class="option-card">
                <i class="fas fa-file-upload card-icon"></i>
                <h3>Upload Existing</h3>
                <p>Let our AI scan your current PDF and fill in the details for you automatically.</p>

                <div class="drop-zone" id="dropZone">
                    <span id="dropText">Drop PDF here or click to upload</span>
                    <input type="file" id="resumeFile" accept=".pdf" hidden>
                </div>

                <button onclick="continueWithPDF()">Continue with PDF</button>
            </div>

            <div class="option-card">
                <i class="fas fa-pen-nib card-icon"></i>
                <h3>Start From Scratch</h3>
                <p>Build your resume manually to ensure every detail is perfectly tailored.</p>
                
                <div class="scratch-placeholder">
                    <i class="fas fa-keyboard" style="font-size: 30px;"></i>
                </div>
                
                <button class="primary-btn" onclick="startManual()">Enter Details Manually</button>
            </div>
        </div>
    </div>

    <script>
        // --- ALL LOGIC FROM YOUR ORIGINAL SCRIPT PRESERVED EXACTLY ---
        const dropZone = document.getElementById("dropZone");
        const fileInput = document.getElementById("resumeFile");
        const dropText = document.getElementById("dropText");

        dropZone.onclick = () => fileInput.click();

        dropZone.addEventListener("dragover", e => {
            e.preventDefault();
            dropZone.classList.add("dragover");
        });

        dropZone.addEventListener("dragleave", () => {
            dropZone.classList.remove("dragover");
        });

        dropZone.addEventListener("drop", e => {
            e.preventDefault();
            dropZone.classList.remove("dragover");
            processPDF(e.dataTransfer.files[0]);
        });

        fileInput.onchange = e => processPDF(e.target.files[0]);

        function parsePdfResumeText(rawText) {
            const data = { name: "", email: "", phone: "", summary: "", experience: "", education: "", skills: "" };
            if (!rawText) return data;
            const lines = rawText.replace(/\r/g, "").split("\n").map(l => l.trim()).filter(Boolean);
            const joined = lines.join(" ");
            const emailMatch = joined.match(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i);
            if (emailMatch) data.email = emailMatch[0];
            const phoneMatch = joined.match(/(\+?\d[\d\s\-]{8,}\d)/);
            if (phoneMatch) data.phone = phoneMatch[0];
            data.name = lines.find(l => l.length < 35 && !l.includes("@") && !/\d/.test(l) && l.split(" ").length <= 4) || "Your Name";
            let current = null;
            let summaryFallback = "";
            lines.forEach((line, index) => {
                const l = line.toLowerCase();
                if (line.match(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i) || line.match(/(\+?\d[\d\s\-]{8,}\d)/)) return;
                if (/summary|professional summary|objective|profile/.test(l)) { current = "summary"; return; }
                if (/experience|employment|work history|career history/.test(l)) { current = "experience"; return; }
                if (/education|qualification|academic|degree/.test(l)) { current = "education"; return; }
                if (/skills|technical skills|technologies|competencies/.test(l)) { current = "skills"; return; }
                if (current) {
                    const cleanedLine = line.replace(/^\s*[-•*]\s*/, "").trim();
                    if (cleanedLine) data[current] += cleanedLine + " ";
                } else if (!data.summary && index < 10 && line.length > 20) {
                    summaryFallback += line + " ";
                }
            });
            if (!data.summary.trim() && summaryFallback.trim()) data.summary = summaryFallback.trim();
            Object.keys(data).forEach(key => { data[key] = data[key].trim(); });
            return data;
        }

        async function processPDF(file) {
            if (!file || file.type !== "application/pdf") {
                alert("Upload a PDF only");
                return;
            }

            // DO NOT TOUCH loggedUser
            localStorage.removeItem("resumeData");
            localStorage.removeItem("resumeSource");
            localStorage.removeItem("selectedTemplate");
            localStorage.removeItem("historyResumeId");

            dropText.textContent = "⏳ Extracting Intelligence...";

            const reader = new FileReader();
            reader.onload = async function () {
                const pdf = await pdfjsLib.getDocument(new Uint8Array(reader.result)).promise;
                let extractedText = "";

                for (let p = 1; p <= pdf.numPages; p++) {
                    const page = await pdf.getPage(p);
                    const content = await page.getTextContent();
                    let lastY = null, line = "", lines = [];

                    content.items.forEach(item => {
                        if (lastY === null || Math.abs(item.transform[5] - lastY) < 2) {
                            line += item.str + " ";
                        } else {
                            lines.push(line.trim());
                            line = item.str + " ";
                        }
                        lastY = item.transform[5];
                    });

                    if (line.trim()) lines.push(line.trim());
                    extractedText += lines.join("\n") + "\n";
                }

                const resumeData = parsePdfResumeText(extractedText);

                localStorage.setItem("resumeData", JSON.stringify(resumeData));
                localStorage.setItem("resumeSource", "pdf");

                dropText.innerHTML = "<i class='fas fa-check-circle'></i> Resume Synced!";
                dropText.style.color = "var(--accent)";
            };

            reader.readAsArrayBuffer(file);
        }

        function continueWithPDF() {
            if (!localStorage.getItem("resumeData")) { alert("Upload a resume first"); return; }
            window.location.href = "template-selection.html";
        }

        function startManual() {
            // Only reset resume-related data
            localStorage.removeItem("resumeData");
            localStorage.removeItem("resumeSource");
            localStorage.removeItem("selectedTemplate");
            localStorage.removeItem("historyResumeId");

            localStorage.setItem("resumeSource", "manual");
            window.location.href = "resume-form.html";
        }

    </script>

</body>
</html>